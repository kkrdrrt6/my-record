<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>record</title>

<style>
body {
  margin: 0;
  background: white;
  color: black;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}
#app { max-width: 820px; margin: auto; padding: 24px; }
header { text-align: center; }

#profile {
  width: 120px; height: 120px;
  border-radius: 50%;
  border: 1px solid black;
  object-fit: cover;
  cursor: pointer;
}

.title { margin-top: 16px; font-size: 20px; }
#clock { font-size: 14px; margin-top: 6px; }

#orbit { width: 120px; height: 120px; margin: 16px auto; }
#orbit svg { animation: spin 30s linear infinite; }
@keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }

nav { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 32px; }
nav button { border: 1px solid black; background: white; padding: 6px 12px; }

.card { border: 1px solid black; padding: 12px; margin-top: 20px; }
input, textarea, select, button {
  width: 100%; margin-top: 8px; padding: 8px;
  border: 1px solid black; background: white;
}

.log {
  border-top: 1px solid black;
  margin-top: 12px;
  padding-top: 8px;
  font-size: 13px;
  cursor: pointer;
}

.log img { width: 100%; margin-top: 6px; border: 1px solid black; }

.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
  margin-top: 12px;
}

.day {
  border: 1px solid black;
  min-height: 80px;
  padding: 4px;
  font-size: 11px;
  cursor: pointer;
}

.day div { font-size: 10px; }
.back { margin-top: 12px; }
</style>
</head>

<body>
<div id="app"></div>

<input type="file" id="profileInput" accept="image/*" hidden>
<input type="file" id="imgInput" accept="image/*" hidden>

<script>
document.addEventListener("DOMContentLoaded", () => {

const app = document.getElementById("app");
const profileInput = document.getElementById("profileInput");
const imgInput = document.getElementById("imgInput");

const categories = ["독서","영화","베이스 연습","작곡 연습"];
let records = JSON.parse(localStorage.getItem("records") || "[]");

let current = "독서";
let editIndex = null;
let tempImage = null;
let selectedDate = null;

const today = new Date();
let year = today.getFullYear();
let month = today.getMonth();

/* UI */
app.innerHTML = `
<header>
  <img id="profile">
  <div class="title">*.˚ ༘♡ ᖰ(°'^'°)ᖳ *.˚ ༘♡</div>
  <div id="clock"></div>
  <div id="orbit">
    <svg viewBox="0 0 120 120">
      <circle cx="60" cy="60" r="38" fill="none" stroke="black"/>
      <circle cx="60" cy="60" r="10" fill="black"/>
      <circle cx="60" cy="22" r="4" fill="black"/>
    </svg>
  </div>
</header>

<nav>
  ${categories.map(c=>`<button data-v="${c}">${c}</button>`).join("")}
  <button data-v="달력">달력</button>
</nav>

<div id="content"></div>
`;

/* PROFILE */
const profile = document.getElementById("profile");
profile.src = localStorage.getItem("profile") || "";
profile.onclick = ()=>profileInput.click();
profileInput.onchange = e=>{
  const f=e.target.files[0]; if(!f)return;
  const r=new FileReader();
  r.onload=()=>{ profile.src=r.result; localStorage.setItem("profile",r.result); };
  r.readAsDataURL(f);
};

/* CLOCK */
setInterval(()=>{
  document.getElementById("clock").textContent =
    new Date().toLocaleTimeString();
},1000);

/* NAV */
document.querySelectorAll("nav button").forEach(b=>{
  b.onclick=()=>{ current=b.dataset.v; selectedDate=null; render(); };
});

function render() {
  const c=document.getElementById("content");
  c.innerHTML="";

  if(current==="달력"){ renderCalendar(c); return; }
  if(current==="날짜"){ renderDateView(c); return; }

  renderCategory(c);
}

/* CATEGORY VIEW */
function renderCategory(c){
  const form=document.createElement("div");
  form.className="card";
  form.innerHTML=`
    <select id="cat">${categories.map(x=>`<option>${x}</option>`).join("")}</select>
    <input id="title" placeholder="제목">
    <textarea id="memo" placeholder="기록"></textarea>
    <button id="imgBtn">이미지</button>
    <button id="save">${editIndex===null?"저장":"수정"}</button>
  `;
  c.appendChild(form);

  document.getElementById("imgBtn").onclick=()=>imgInput.click();
  imgInput.onchange=e=>{
    const f=e.target.files[0]; if(!f)return;
    const r=new FileReader();
    r.onload=()=>tempImage=r.result;
    r.readAsDataURL(f);
  };

  records.forEach((r,i)=>{
    if(r.cat!==current)return;
    renderLog(c,r,i);
  });

  document.getElementById("save").onclick=()=>saveRecord();
}

/* DATE VIEW */
function renderDateView(c){
  const h=document.createElement("strong");
  h.textContent = selectedDate;
  c.appendChild(h);

  const list = records
    .map((r,i)=>({...r,i}))
    .filter(r=>r.date===selectedDate);

  list.forEach(r=>renderLog(c,r,r.i));

  const back=document.createElement("button");
  back.textContent="← 달력으로";
  back.className="back";
  back.onclick=()=>{ current="달력"; render(); };
  c.appendChild(back);
}

/* LOG */
function renderLog(c,r,i){
  const div=document.createElement("div");
  div.className="log";
  div.innerHTML=`
    <strong>${r.date} · ${r.title}</strong><br>${r.memo||""}
    ${r.image?`<img src="${r.image}">`:""}
    <button data-del>삭제</button>
  `;
  div.onclick=()=>{
    editIndex=i;
    current=r.cat;
    selectedDate=null;
    render();
    document.getElementById("cat").value=r.cat;
    document.getElementById("title").value=r.title;
    document.getElementById("memo").value=r.memo;
    tempImage=r.image;
  };
  div.querySelector("[data-del]").onclick=e=>{
    e.stopPropagation();
    records.splice(i,1);
    localStorage.setItem("records",JSON.stringify(records));
    render();
  };
  c.appendChild(div);
}

/* SAVE */
function saveRecord(){
  const title=document.getElementById("title").value.trim();
  if(!title)return;
  const d=new Date();
  const data={
    cat:document.getElementById("cat").value,
    title,
    memo:document.getElementById("memo").value,
    image:tempImage,
    y:d.getFullYear(), m:d.getMonth(), d:d.getDate(),
    date:d.toLocaleDateString()
  };
  if(editIndex===null) records.push(data);
  else records[editIndex]=data;

  editIndex=null; tempImage=null;
  localStorage.setItem("records",JSON.stringify(records));
  render();
}

/* CALENDAR */
function renderCalendar(el){
  el.innerHTML=`<strong>${year}.${month+1}</strong>`;
  const cal=document.createElement("div");
  cal.className="calendar";

  const last=new Date(year,month+1,0).getDate();
  for(let d=1;d<=last;d++){
    const cell=document.createElement("div");
    cell.className="day";
    cell.innerHTML=d;
    const dayRecords=records.filter(r=>r.y===year&&r.m===month&&r.d===d);
    dayRecords.forEach(r=>{
      cell.innerHTML+=`<div>· ${r.title}</div>`;
    });
    cell.onclick=()=>{
      if(dayRecords.length){
        selectedDate = dayRecords[0].date;
        current = "날짜";
        render();
      }
    };
    cal.appendChild(cell);
  }
  el.appendChild(cal);
}

render();
});
</script>
</body>
</html>
